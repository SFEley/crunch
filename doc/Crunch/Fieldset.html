<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Crunch::Fieldset</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (F)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Crunch.html" title="Crunch (module)">Crunch</a></span></span>
     &raquo; 
    <span class="title">Fieldset</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Crunch::Fieldset
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Hash</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Hash</li>
          
            <li class="next">Crunch::Fieldset</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/crunch/fieldset.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
What the BSON spec describes as a &#8220;document&#8221; &#8212; a hashlike
binary structure.  In practice, a Fieldset is a <em>lot</em> like a Hash,
with two major differences:
</p>
<pre class="code">
  1. All keys are strings; and
  2. It's immutable. (Hence, #[]= and all in-place modifiers like #merge! are missing.)</pre>


  </div>
</div>
<div class="tags">
  
  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://bsonspec.org/#/specification" target="_parent" title="http://bsonspec.org/#/specification">http://bsonspec.org/#/specification</a></li>
    
  </ul>

</div>

  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%5B%5D%3D-instance_method" title="#[]= (instance method)">- (Object) <strong>[]=</strong>(*args) </a>
    

    
      (also: #update, #store, #shift, #replace, #reject!, #rehash, #merge!, #delete_if, #delete, #clear)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
We&#8217;re immutable!  These pesky modification methods aren&#8217;t
allowed.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Fieldset) <strong>initialize</strong>(data = nil) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of Fieldset.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_s-instance_method" title="#to_s (instance method)">- (Object) <strong>to_s</strong> </a>
    

    
      (also: #to_bson)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the document as a binary string in BSON format.
</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Crunch::Fieldset (class)">Fieldset</a></span></tt>) <strong>initialize</strong>(data = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new instance of Fieldset
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>optional</tt>, <tt>Hash</tt>, <tt>String</tt>, <tt>Array</tt>, <tt>BSON::ByteBuffer</tt>)</span>
      
      
        <span class='name'>data</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Sets the hash values &#8212; either directly, or after deserializing if a
BSON binary string is provided
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/fieldset.rb', line 45</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id data'>data</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
  
  <span class='id hash'>hash</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id data'>data</span>
  <span class='kw'>when</span> <span class='const'>Fieldset</span> <span class='kw'>then</span> <span class='id data'>data</span>   <span class='comment'># Don't bother doing anything
</span>  <span class='kw'>when</span> <span class='const'>Hash</span> <span class='kw'>then</span> <span class='id stringify_keys'>stringify_keys</span><span class='lparen'>(</span><span class='id data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>String</span> <span class='kw'>then</span> <span class='const'>BSON</span><span class='period'>.</span><span class='id deserialize'>deserialize</span><span class='lparen'>(</span><span class='const'>BSON</span><span class='op'>::</span><span class='const'>ByteBuffer</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id data'>data</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>BSON</span><span class='op'>::</span><span class='const'>ByteBuffer</span> <span class='kw'>then</span> <span class='const'>BSON</span><span class='period'>.</span><span class='id deserialize'>deserialize</span><span class='lparen'>(</span><span class='id data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Array</span> <span class='kw'>then</span> <span class='id hashify_elements'>hashify_elements</span><span class='lparen'>(</span><span class='id data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='kw'>nil</span> <span class='kw'>then</span> <span class='kw'>nil</span>
  <span class='kw'>else</span> <span class='id raise'>raise</span> <span class='const'>FieldsetError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Crunch::Fieldset can only be initialized from a hash or binary data! You supplied: </span><span class='embexpr_beg'>#{</span><span class='id data'>data</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='id private_replace'>private_replace</span><span class='lparen'>(</span><span class='id hash'>hash</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id hash'>hash</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id freeze'>freeze</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="[]=-instance_method">
  
    - (<tt>Object</tt>) <strong>[]=</strong>(*args) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='update-instance_method'>update</span>, <span id='store-instance_method'>store</span>, <span id='shift-instance_method'>shift</span>, <span id='replace-instance_method'>replace</span>, <span id='reject!-instance_method'>reject!</span>, <span id='rehash-instance_method'>rehash</span>, <span id='merge!-instance_method'>merge!</span>, <span id='delete_if-instance_method'>delete_if</span>, <span id='delete-instance_method'>delete</span>, <span id='clear-instance_method'>clear</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
We&#8217;re immutable!  These pesky modification methods aren&#8217;t
allowed. (If you&#8217;re wondering WHY we&#8217;re immutable, consider the
difference between MongoDB retrieval techniques and MongoDB value setting
techniques. Then consider what it would be like if we had to make every
hash in Crunch threadsafe against document changes queued up in
EventMachine. Then consider pretty puppies and rainbows, because
you&#8217;re gonna need a break.)
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="FieldsetError.html" title="Crunch::FieldsetError (class)">FieldsetError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/fieldset.rb', line 30</span>

<span class='kw'>def</span> <span class='op'>[]=</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>FieldsetError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fieldset objects are immutable!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="to_s-instance_method">
  
    - (<tt>Object</tt>) <strong>to_s</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='to_bson-instance_method'>to_bson</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the document as a binary string in BSON format.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'></span>
      
      
      
      
        
        <div class='inline'><p>
String
</p>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://bsonspec.org/#/specification" target="_parent" title="http://bsonspec.org/#/specification">http://bsonspec.org/#/specification</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/fieldset.rb', line 20</span>

<span class='kw'>def</span> <span class='id to_s'>to_s</span>
  <span class='const'>BSON</span><span class='period'>.</span><span class='id serialize'>serialize</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon Jan 31 17:12:15 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.4 (ruby-1.9.2).
</div>

  </body>
</html>