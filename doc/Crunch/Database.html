<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Crunch::Database</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (D)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Crunch.html" title="Crunch (module)">Crunch</a></span></span>
     &raquo; 
    <span class="title">Database</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Crunch::Database
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Crunch::Database</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/crunch/database.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Our highest-level object is NOT the connection; it&#8217;s the database.
Each database has one write connection and may have multiple read
connections at any given time, which will be managed automatically by
Crunch, and can accept one authentication (if necessary).  This
dramatically simplifies the API.
</p>
<p>
To get an instance, call Crunch::Database.connect instead of .new &#8212;
this ensures that other attempts to connect with the same credentials will
get the same database object and share the same connections.
</p>


  </div>
</div>
<div class="tags">
  
</div>

  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#command-instance_method" title="#command (instance method)">- (Object) <strong>command</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute command.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#heartbeat-instance_method" title="#heartbeat (instance method)">- (Object) <strong>heartbeat</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute heartbeat.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#host-instance_method" title="#host (instance method)">- (Object) <strong>host</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute host.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_connections-instance_method" title="#max_connections (instance method)">- (Object) <strong>max_connections</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute max_connections.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#min_connections-instance_method" title="#min_connections (instance method)">- (Object) <strong>min_connections</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute min_connections.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#name-instance_method" title="#name (instance method)">- (Object) <strong>name</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute name.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#port-instance_method" title="#port (instance method)">- (Object) <strong>port</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute port.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#requests-instance_method" title="#requests (instance method)">- (Object) <strong>requests</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute requests.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout-instance_method" title="#timeout (instance method)">- (Object) <strong>timeout</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute timeout.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect-class_method" title="connect (class method)">+ (Object) <strong>connect</strong>(name, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns a database object from which you can query or obtain
Crunch::Collections.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%3C%3C-instance_method" title="#&lt;&lt; (instance method)">- (Object) <strong>&lt;&lt;</strong>(message) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Accepts a message to be sent to MongoDB (insert, update, query, etc.),
schedules it in EventMachine, and returns immediately.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collection-instance_method" title="#collection (instance method)">- (Object) <strong>collection</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns a Crunch::Collection from the database.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connection_count-instance_method" title="#connection_count (instance method)">- (Object) <strong>connection_count</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The number of connections to the Mongo server this Database is maintaining.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pending_count-instance_method" title="#pending_count (instance method)">- (Object) <strong>pending_count</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The number of messages waiting in the queue to be sent to the Mongo server.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#receive_reply-instance_method" title="#receive_reply (instance method)">- (Object) <strong>receive_reply</strong>(reply) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Receives a deserialized reply message from MongoDB and routes it to the
original sender.
</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="command-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="command-instance_method">
  
    - (<tt>Object</tt>) <strong>command</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute command
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 17</span>

<span class='kw'>def</span> <span class='id command'>command</span>
  <span class='ivar'>@command</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="heartbeat-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="heartbeat-instance_method">
  
    - (<tt>Object</tt>) <strong>heartbeat</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute heartbeat
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 17</span>

<span class='kw'>def</span> <span class='id heartbeat'>heartbeat</span>
  <span class='ivar'>@heartbeat</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="host-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="host-instance_method">
  
    - (<tt>Object</tt>) <strong>host</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute host
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 17</span>

<span class='kw'>def</span> <span class='id host'>host</span>
  <span class='ivar'>@host</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="max_connections-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="max_connections-instance_method">
  
    - (<tt>Object</tt>) <strong>max_connections</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute max_connections
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 17</span>

<span class='kw'>def</span> <span class='id max_connections'>max_connections</span>
  <span class='ivar'>@max_connections</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="min_connections-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="min_connections-instance_method">
  
    - (<tt>Object</tt>) <strong>min_connections</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute min_connections
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 17</span>

<span class='kw'>def</span> <span class='id min_connections'>min_connections</span>
  <span class='ivar'>@min_connections</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="name-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="name-instance_method">
  
    - (<tt>Object</tt>) <strong>name</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute name
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 17</span>

<span class='kw'>def</span> <span class='id name'>name</span>
  <span class='ivar'>@name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="port-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="port-instance_method">
  
    - (<tt>Object</tt>) <strong>port</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute port
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 17</span>

<span class='kw'>def</span> <span class='id port'>port</span>
  <span class='ivar'>@port</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="requests-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="requests-instance_method">
  
    - (<tt>Object</tt>) <strong>requests</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute requests
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 17</span>

<span class='kw'>def</span> <span class='id requests'>requests</span>
  <span class='ivar'>@requests</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="timeout-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="timeout-instance_method">
  
    - (<tt>Object</tt>) <strong>timeout</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute timeout
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 17</span>

<span class='kw'>def</span> <span class='id timeout'>timeout</span>
  <span class='ivar'>@timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="connect-class_method">
  
    + (<tt>Object</tt>) <strong>connect</strong>(name, opts = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns a database object from which you can query or obtain
Crunch::Collections. An immediate connection will be made to verify the
connection and authentication parameters.  If the database doesn&#8217;t
exist, it will be created if possible.  (Pass :create => false if you
don&#8217;t want this.)
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>name</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The name of the MongoDB database
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>optional</tt>, <tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Connection options
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <h3>Options Hash (<tt>opts</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>String</tt>)</span>
          <span class="name">:host</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Connection hostname (defaults to localhost)
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="name">:port</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Connection port (default to 27017)
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>String</tt>)</span>
          <span class="name">:user</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Authentication username, if needed
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>String</tt>)</span>
          <span class="name">:pass</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Authentication password, if needed
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="name">:admin</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Check the username and password against the &#8216;admin&#8217; database
instead of the named database (defaults to false)
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="name">:create</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Create the database if it doesn&#8217;t exist (defaults to true)
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="name">:min_connections</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Always maintain at least this many connections (defaults to 1)
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="name">:max_connections</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Never create more than this many connections (defaults to 10)
</p>
</div>
        </tr>
      
        <li>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="name">:heartbeat</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
Frequency (in seconds) to perform connection maintenance (defaults to 1)
</p>
</div>
        </tr>
      
    </ul>
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'></span>
      
      
      
      
        
        <div class='inline'><p>
Database The new or existing database object
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 38</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id connect'>connect</span><span class='lparen'>(</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='comment'># Flesh out our options, we're gonna need them...
</span>  <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Crunch</span><span class='period'>.</span><span class='id options'>options</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id opts'>opts</span><span class='rparen'>)</span>
  <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id name'>name</span><span class='period'>.</span><span class='id to_s'>to_s</span>

  <span class='cvar'>@@databases</span><span class='lbracket'>[</span><span class='id options'>options</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id new'>new</span> <span class='id options'>options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="<<-instance_method">
  
    - (<tt>Object</tt>) <strong>&lt;&lt;</strong>(message) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Accepts a message to be sent to MongoDB (insert, update, query, etc.),
schedules it in EventMachine, and returns immediately.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="Message.html" title="Crunch::Message (class)">Message</a></span></tt>)</span>
      
      
        <span class='name'>message</span>
      
      
      
        &mdash;
        <div class='inline'><p>
An instance of a Message subclass
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'></span>
      
      
      
      
        
        <div class='inline'><p>
true
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="DatabaseError.html" title="Crunch::DatabaseError (class)">DatabaseError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 51</span>

<span class='kw'>def</span> <span class='op'>&lt;&lt;</span><span class='lparen'>(</span><span class='id message'>message</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>DatabaseError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The data to be sent must be a Message class; instead you sent a </span><span class='embexpr_beg'>#{</span><span class='id message'>message</span><span class='period'>.</span><span class='id class'>class</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id message'>message</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:deliver</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id message'>message</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:sender</span><span class='rparen'>)</span>
    <span class='id senders'>senders</span><span class='lbracket'>[</span><span class='id message'>message</span><span class='period'>.</span><span class='id request_id'>request_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>sender:</span> <span class='id message'>message</span><span class='period'>.</span><span class='id sender'>sender</span><span class='comma'>,</span> <span class='label'>sent_at:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='const'>EventMachine</span><span class='period'>.</span><span class='id defer'>defer</span> <span class='tlambda'>-&gt;</span><span class='tlambeg'>{</span><span class='id message'>message</span><span class='period'>.</span><span class='id deliver'>deliver</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span><span class='id message_data'>message_data</span> <span class='tlambeg'>{</span><span class='id requests'>requests</span><span class='period'>.</span><span class='id push'>push</span> <span class='id message_data'>message_data</span><span class='rbrace'>}</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="collection-instance_method">
  
    - (<tt>Object</tt>) <strong>collection</strong>(name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns a Crunch::Collection from the database. Really just a shortcut for
Collection::new.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>name</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The base name of the collection to retrieve
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 75</span>

<span class='kw'>def</span> <span class='id collection'>collection</span><span class='lparen'>(</span><span class='id name'>name</span><span class='rparen'>)</span>
  <span class='const'>Collection</span><span class='period'>.</span><span class='id send'>send</span> <span class='symbol'>:new</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id name'>name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="connection_count-instance_method">
  
    - (<tt>Object</tt>) <strong>connection_count</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The number of connections to the Mongo server this Database is maintaining.
This is ordinarily self-managed, but you can set minimum and maximum counts
to resize the connection pool if you&#8217;re the micromanaging type.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 89</span>

<span class='kw'>def</span> <span class='id connection_count'>connection_count</span>
  <span class='id connections'>connections</span><span class='period'>.</span><span class='id size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pending_count-instance_method">
  
    - (<tt>Object</tt>) <strong>pending_count</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The number of messages waiting in the queue to be sent to the Mongo server.
In a happy world where there enough connections to handle requests, this
will remain close to 0.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 82</span>

<span class='kw'>def</span> <span class='id pending_count'>pending_count</span>
  <span class='id requests'>requests</span><span class='period'>.</span><span class='id size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="receive_reply-instance_method">
  
    - (<tt>Object</tt>) <strong>receive_reply</strong>(reply) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Receives a deserialized reply message from MongoDB and routes it to the
original sender.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/crunch/database.rb', line 63</span>

<span class='kw'>def</span> <span class='id receive_reply'>receive_reply</span><span class='lparen'>(</span><span class='id reply'>reply</span><span class='rparen'>)</span>
  <span class='comment'># The 'response_to' field is the third 32-bit integer in the message
</span>  <span class='id reply_id'>reply_id</span> <span class='op'>=</span> <span class='id reply'>reply</span><span class='lbracket'>[</span><span class='int'>8</span><span class='op'>..</span><span class='int'>11</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>V</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id first'>first</span>
  <span class='id sender'>sender</span><span class='lparen'>(</span><span class='id reply_id'>reply_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id succeed'>succeed</span> <span class='id reply'>reply</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon Jan 31 17:12:15 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.4 (ruby-1.9.2).
</div>

  </body>
</html>